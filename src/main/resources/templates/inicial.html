<!DOCTYPE html>
<html lang="pt-BR" 
	xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tchomp inicial</title>
	
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

	<!-- Navbar Principal -->
				    <nav class="navbar navbar-expand-lg main-navbar">
				      <div class="container-fluid">
						
						<!-- LOGO -->
						   <a class="navbar-brand text-white fw-bold" href="/inicial">TCHOMP</a>

						   <!-- BOTÃO TOGGLER (MOBILE) -->
						   <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
						     <span class="navbar-toggler-icon"></span>
						   </button>

				        <!-- Links centralizados + barra de pesquisa -->
				        <div class="collapse navbar-collapse justify-content-center" id="navbarMain">
				          <div class="navbar-nav mx-auto d-flex justify-content-center">
				            <a class="nav-link" th:href="@{/inicial}">Página Inicial</a>
				            <a class="nav-link" th:href="@{/restaurantes}">Restaurantes</a>
				            <a class="nav-link" th:href="@{/perfil}">Perfil</a>
							<!-- Só aparece se o usuário tiver ROLE_ADMIN -->
							<a class="nav-link" th:href="@{/adm}" sec:authorize="hasRole('ADMIN')">Administração</a>
				            <a class="nav-link" th:href="@{/sobre}">Sobre</a>
				          </div>
						  
						  <!-- Botão Favoritos -->
						  <a th:href="@{/favoritos}" class="btn btn-favorite ms-3">
						      <i class="bi bi-heart me-1"></i> Favoritos
						  </a>

				          <!-- Barra de pesquisa estilizada -->
				          <form class="d-flex ms-3 search-box" th:action="@{/buscar}" method="get">
				            <input class="form-control" type="search" placeholder="Buscar..." aria-label="Search" name="q">
				            <button class="btn btn-search" type="submit">
				              <i class="bi bi-search"></i>
				            </button>
				          </form>
						  <!-- Botão Sair -->
						  <a href="/logout" class="btn btn-logout ms-3">
						      <i class="bi bi-box-arrow-right me-1"></i> Sair
						  </a>
				        </div>
				      </div>
				    </nav>

	<div class="fullscreen-menu"> 
	    <div class="container">
	        <h1>Qual culinária você prefere?</h1>
	        
	        <div class="menu-grid">
	            <div class="menu-card" 
	                 th:each="culinaria : ${culinarias}"
	                 th:data-culinaria="${culinaria}"  
	                 onclick="irParaCulinaria(this)">
	                <i class="fas fa-utensils"></i> 
	                <h3 th:text="${culinaria}">Culinária</h3>
	                <p th:text="'Veja todos os restaurantes de culinária ' + ${culinaria}">Descrição</p>
	            </div>
	        </div>
	    </div>
	</div>

    <div class="container mt-5 mb-5"> <h2 class="text-center mb-4">Últimas Avaliações</h2>

        <div th:if="${#lists.isEmpty(avaliacoesRecentes)}" class="text-center text-muted">
            <p>Ainda não há avaliações. Seja o primeiro a avaliar!</p>
        </div>

        <div th:unless="${#lists.isEmpty(avaliacoesRecentes)}" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            
            <div th:each="avaliacao : ${avaliacoesRecentes}" class="col">
                <div class="card h-100 shadow-sm"> <div class="card-body d-flex flex-column"> <h5 class="card-title mb-1">
                            <a th:href="@{/modelo-restaurante(id=${avaliacao.restaurante?.id})}" 
                               th:text="${avaliacao.restaurante?.nome ?: 'Restaurante Desconhecido'}">
                                Nome do Restaurante
                            </a>
                        </h5>

                        <div class="mb-2">
                            <span th:each="i : ${#numbers.sequence(1, 5)}">
                                <i class="bi" th:classappend="${i <= avaliacao.overallRating} ? 'bi-star-fill text-warning' : 'bi-star text-muted'"></i>
                            </span>
                        </div>

                        <p class="card-text text-muted mb-auto" th:text="${#strings.abbreviate(avaliacao.comment ?: '', 100)}">
                            Comentário da avaliação... 
                        </p> 

                        <div class="mt-3 border-top pt-2">
                             <small class="text-muted" 
                                    th:text="${(avaliacao.usuario?.nomeExibicao ?: 'Usuário Anônimo') + ' - ' + #temporals.format(avaliacao.reviewDate, 'dd/MM/yyyy')}">
                                    Usuário - Data
                             </small>
                        </div>
                    </div> </div> </div> </div> </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function irParaCulinaria(elementoCard) {
            const culinaria = elementoCard.getAttribute('data-culinaria');
            const url = '/restaurantes?culinaria=' + encodeURIComponent(culinaria) + '&cidade=Guarulhos';
            window.location.href = url;
        }
    </script>

</body>
</html>