<!DOCTYPE html>
<html lang="pt-BR" 
	xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tchomp Perfil</title>
  
  <!-- Bootstrap CSS (estável) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- Font Awesome (para os ícones dos cards) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	
	<!-- Bootstrap Bundle com Popper (necessário para navbar mobile) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Seu CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
  </head>
  <body>

  	<!-- Navbar Principal -->
  		    <nav class="navbar navbar-expand-lg main-navbar">
  		      <div class="container-fluid">
  				
  				<!-- LOGO -->
  				   <a class="navbar-brand text-white fw-bold" href="/inicial">TCHOMP</a>

  				   <!-- BOTÃO TOGGLER (MOBILE) -->
  				   <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
  				     <span class="navbar-toggler-icon"></span>
  				   </button>

  		        <!-- Links centralizados + barra de pesquisa -->
  		        <div class="collapse navbar-collapse justify-content-center" id="navbarMain">
  		          <div class="navbar-nav mx-auto d-flex justify-content-center">
  		            <a class="nav-link" th:href="@{/inicial}">Página Inicial</a>
  		            <a class="nav-link" th:href="@{/restaurantes}">Restaurantes</a>
  		            <a class="nav-link" th:href="@{/perfil}">Perfil</a>
					<!-- Só aparece se o usuário tiver ROLE_ADMIN -->
					<a class="nav-link" th:href="@{/adm}" sec:authorize="hasRole('ADMIN')">Administração</a>
  		            <a class="nav-link" th:href="@{/sobre}">Sobre</a>
  		          </div>
  				  
  				  <!-- Botão Favoritos -->
  				  <a th:href="@{/favoritos}" class="btn btn-favorite ms-3">
  				      <i class="bi bi-heart me-1"></i> Favoritos
  				  </a>

  		          <!-- Barra de pesquisa estilizada -->
  		          <form class="d-flex ms-3 search-box" th:action="@{/buscar}" method="get">
  		            <input class="form-control" type="search" placeholder="Buscar..." aria-label="Search" name="q">
  		            <button class="btn btn-search" type="submit">
  		              <i class="bi bi-search"></i>
  		            </button>
  		          </form>
  				  <!-- Botão Sair -->
  				  <a href="/logout" class="btn btn-logout ms-3">
  				      <i class="bi bi-box-arrow-right me-1"></i> Sair
  				  </a>
  		        </div>
  		      </div>
  		    </nav>
			
  <!-- Conteúdo Perfil -->
  <div class="profile-container">
    <div class="profile-card">
      <h2>Perfil do Usuário</h2>
      
      <form th:action="@{/perfil/atualizar}" method="post" th:object="${usuario}">
        
        <input type="hidden" th:field="*{idUsuario}" />

        <label for="nome">Nome</label>
        <input type="text" id="nome" th:field="*{nomeUsuario}">

        <label for="email">E-mail</label>
        <input type="email" id="email" th:field="*{emailUsuario}" readonly>

        <label for="endereco">Endereço</label>
        <input type="text" id="endereco" th:field="*{enderecoUsuario}">

        <div class="profile-buttons">
          <a href="/inicial" class="btn-voltar">Voltar</a>
          <button type="submit" class="btn-salvar">Salvar</button>
          <button type="button" class="btn-excluir" id="btnExcluir">Excluir Conta</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Pop-up Confirmação -->
  <div class="popup" id="popupConfirm">
    <div class="popup-content">
      <p>Tem certeza de que deseja excluir sua conta? Esta ação não pode ser desfeita.</p>
      
      <form th:action="@{/perfil/excluir}" method="post" id="formExcluir">
          <button type="submit" class="popup-confirm" id="confirmDelete">Excluir</button>
      </form>
      
      <button class="popup-cancel" id="cancelDelete">Cancelar</button>
    </div>
  </div>

  <!-- Script Pop-up -->
  <script>
    const btnExcluir = document.getElementById('btnExcluir');
    const popup = document.getElementById('popupConfirm');
    const cancelDelete = document.getElementById('cancelDelete');
    // O botão 'confirmDelete' agora é o submit do formExcluir
    // Não precisamos mais de um JS para ele.

    btnExcluir.addEventListener('click', () => {
      popup.classList.add('active');
    });

    cancelDelete.addEventListener('click', () => {
      // Importante: use 'type="button"' no HTML do 'cancelDelete'
      // ou adicione e.preventDefault() aqui se ele estiver dentro do form
      popup.classList.remove('active');
    });

    // O script 'confirmDelete' não é mais necessário,
    // pois o botão agora é um 'submit' do formulário de exclusão.
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
